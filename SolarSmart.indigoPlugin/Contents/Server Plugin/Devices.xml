<?xml version="1.0"?>
<Devices>

  <!-- SolarSmart main controller -->
  <Device type="custom" id="solarsmartMain">
    <Name>SolarSmart Main</Name>

    <ConfigUI>
      <!-- Intro -->
      <Field id="intro" type="label" fontColor="blue" fontSize="large">
        <Label>Select the Indigo device + state for PV, consumption, and battery power (Watts).</Label>
      </Field>

      <!-- ===== PV (required) ===== -->
      <Field id="sep_pv" type="separator"/>
      <Field id="pvHeader" type="label" fontColor="black" fontSize="medium">
        <Label>Solar PV Production (Watts)</Label>
      </Field>

      <Field id="pvDeviceId" type="menu" defaultValue="">
        <Label>PV Device:</Label>
        <List class="self" method="pv_device_list" dynamicReload="true"/>
        <CallbackMethod>pv_device_changed</CallbackMethod>
      </Field>

      <Field id="pvStateId" type="menu" defaultValue="">
        <Label>PV State:</Label>
        <List class="self" method="pv_state_list" dynamicReload="true"/>
      </Field>

      <!-- ===== Site Consumption (optional) ===== -->
      <Field id="sep_cons" type="separator"/>
      <Field id="consHeader" type="label" fontColor="black" fontSize="medium">
        <Label>Site Consumption (Watts) — optional</Label>
      </Field>

      <Field id="consDeviceId" type="menu" defaultValue="">
        <Label>Consumption Device:</Label>
        <List class="self" method="consumption_device_list" dynamicReload="true"/>
        <CallbackMethod>consumption_device_changed</CallbackMethod>
      </Field>

      <Field id="consStateId" type="menu" defaultValue="">
        <Label>Consumption State:</Label>
        <List class="self" method="consumption_state_list" dynamicReload="true"/>
      </Field>
      <!-- ===== Grid Power (optional) ===== -->
      <Field id="grid_batt" type="separator"/>

      <Field id="useGridHeadroom" type="checkbox" tooltip="Enabling will use Grid information as Net everything.">
        <Label>Use Grid Data Only:</Label>
        <Description> Use Grid usage + / - as only factor in load</Description>
    </Field>
      <Field id="gridHeader" type="label" fontColor="black" fontSize="medium">
        <Label>Grid Power (Watts; + = charging, − = discharging)</Label>
      </Field>

      <Field id="gridDeviceId" type="menu" defaultValue="">
        <Label>Grid Device:</Label>
        <List class="self" method="grid_device_list" dynamicReload="true"/>
        <CallbackMethod>grid_device_changed</CallbackMethod>
      </Field>

      <Field id="gridStateId" type="menu" defaultValue="">
        <Label>Grid State:</Label>
        <List class="self" method="grid_state_list" dynamicReload="true"/>
       </Field>
      <!-- ===== Battery Power (optional) ===== -->
      <Field id="sep_batt" type="separator"/>
      <Field id="battHeader" type="label" fontColor="black" fontSize="medium">
        <Label>Battery Power (Watts; + = charging, − = discharging) — optional</Label>
      </Field>

      <Field id="battDeviceId" type="menu" defaultValue="">
        <Label>Battery Device:</Label>
        <List class="self" method="battery_device_list" dynamicReload="true"/>
        <CallbackMethod>battery_device_changed</CallbackMethod>
      </Field>

      <Field id="battStateId" type="menu" defaultValue="">
        <Label>Battery State:</Label>
        <List class="self" method="battery_state_list" dynamicReload="true"/>
      </Field>

 <Field id="sep_hint_2" type="separator"/>
        <Field id="maxConcurrentLoads" type="textfield" defaultValue="2">
    <Label>Max Concurrent Loads</Label>
    <Description>Maximum number of SmartSolar loads allowed to run simultaneously.</Description>
  </Field>

      <!-- ===== Hints ===== -->
      <Field id="sep_hint" type="separator"/>
      <Field id="hint" type="label" fontColor="darkgray" fontSize="small" alwaysUseInDialogHeightCalc="true">
        <Label>Values are expected in Watts. If your source is kW or a string, normalize in the plugin before updating states.</Label>
      </Field>

<Field id="enableSolarForecast" type="checkbox" defaultValue="false">
  <Label>Enable Solar Forecast (forecast.solar)</Label>
  <Description>Uses forecast.solar public estimate endpoint with conservative caching to respect rate limits.</Description>
</Field>

<Field id="fsTiltDeclinationDeg" type="textfield" defaultValue="30"  visibleBindingId="enableSolarForecast" visibleBindingValue="true">
  <Label>Panel Tilt / Declination (deg)</Label>
  <Description>0 = horizontal, 90 = vertical</Description>
</Field>
<Field id="fsAzimuthDeg" type="textfield" defaultValue="0"  visibleBindingId="enableSolarForecast" visibleBindingValue="true">
  <Label>Panel Azimuth (deg, 0=South, 90=West, 180=North, 270=East)</Label>
  <Description>Per forecast.solar convention. For East, you may enter -90 as well.</Description>
</Field>
<Field id="fsSystemKwp" type="textfield" defaultValue="5.0"  visibleBindingId="enableSolarForecast" visibleBindingValue="true">
  <Label>System Size (kWp DC)</Label>
</Field>


    </ConfigUI>

    <!-- Show PV production in device list -->
    <UiDisplayStateId>Headroom</UiDisplayStateId>

    <States>
      <State id="SolarProduction">
        <ValueType>Integer</ValueType>
        <TriggerLabel>Solar production changed</TriggerLabel>
        <ControlPageLabel>Solar production (W)</ControlPageLabel>
      </State>

      <State id="SiteConsumption">
        <ValueType>Integer</ValueType>
        <TriggerLabel>Site consumption changed</TriggerLabel>
        <ControlPageLabel>Site consumption (W)</ControlPageLabel>
      </State>

      <State id="BatteryPower">
        <ValueType>Integer</ValueType>
        <TriggerLabel>Battery power changed</TriggerLabel>
        <ControlPageLabel>Battery power (W)</ControlPageLabel>
      </State>

      <State id="GridPower">
        <ValueType>Integer</ValueType>
        <TriggerLabel>Grid power</TriggerLabel>
        <ControlPageLabel>Grid power (W)</ControlPageLabel>
      </State>
      <!-- Optional computed helper, populated by the plugin -->
      <State id="Headroom">
        <ValueType>Integer</ValueType>
        <TriggerLabel>Headroom changed</TriggerLabel>
        <ControlPageLabel>Available headroom (W)</ControlPageLabel>
      </State>

      <State id="LastUpdate">
        <ValueType>String</ValueType>
        <TriggerLabel>Last update changed</TriggerLabel>
        <ControlPageLabel>Last updated</ControlPageLabel>
      </State>

      <State id="schedulerTable">
    <ValueType>String</ValueType>
    <TriggerLabel>Scheduler Table</TriggerLabel>
    <ControlPageLabel>Scheduler Table</ControlPageLabel>
</State>
<State id="schedulerImageURL">
  <ValueType>String</ValueType>
  <TriggerLabel>Scheduler Image URL</TriggerLabel>
  <ControlPageLabel>Scheduler Image URL</ControlPageLabel>
</State>
<State id="schedulerImagePath">
  <ValueType>String</ValueType>
  <TriggerLabel>Scheduler Image Path</TriggerLabel>
  <ControlPageLabel>Scheduler Image Path</ControlPageLabel>
</State>
      <State id="forecastTodayDate">
  <ValueType>String</ValueType>
  <TriggerLabel>Forecast today date changed</TriggerLabel>
  <ControlPageLabel>Forecast today date</ControlPageLabel>
</State>
<State id="forecastTodayKWh">
  <ValueType>Float</ValueType>
  <TriggerLabel>Forecast today kWh changed</TriggerLabel>
  <ControlPageLabel>Forecast today (kWh)</ControlPageLabel>
</State>
<State id="forecastPeakKWToday">
  <ValueType>Float</ValueType>
  <TriggerLabel>Forecast peak kW today changed</TriggerLabel>
  <ControlPageLabel>Forecast peak today (kW)</ControlPageLabel>
</State>
<State id="forecastPeakTimeToday">
  <ValueType>String</ValueType>
  <TriggerLabel>Forecast peak time today changed</TriggerLabel>
  <ControlPageLabel>Forecast peak time today</ControlPageLabel>
</State>
<State id="forecastSolarSummary">
  <ValueType>String</ValueType>
  <TriggerLabel>Forecast.Solar summary changed</TriggerLabel>
  <ControlPageLabel>Forecast.Solar summary lines</ControlPageLabel>
</State>
      <State id="forecastSolarPeaks">
  <ValueType>String</ValueType>
  <TriggerLabel>Forecast.Solar Peaks</TriggerLabel>
  <ControlPageLabel>Forecast.Solar Peaks lines</ControlPageLabel>
</State>
<State id="forecastTomorrowDate">
  <ValueType>String</ValueType>
  <TriggerLabel>Forecast tomorrow date changed</TriggerLabel>
  <ControlPageLabel>Forecast tomorrow date</ControlPageLabel>
</State>
<State id="forecastTomorrowKWh">
  <ValueType>Float</ValueType>
  <TriggerLabel>Forecast tomorrow kWh changed</TriggerLabel>
  <ControlPageLabel>Forecast tomorrow (kWh)</ControlPageLabel>
</State>
<State id="forecastPeakKWTomorrow">
  <ValueType>Float</ValueType>
  <TriggerLabel>Forecast peak kW tomorrow changed</TriggerLabel>
  <ControlPageLabel>Forecast peak tomorrow (kW)</ControlPageLabel>
</State>
<State id="forecastPeakTimeTomorrow">
  <ValueType>String</ValueType>
  <TriggerLabel>Forecast peak time tomorrow changed</TriggerLabel>
  <ControlPageLabel>Forecast peak time tomorrow</ControlPageLabel>
</State>

    </States>
  </Device>

  <!-- ===================== -->
<!-- SolarSmart Load device -->
<!-- ===================== -->
<Device type="custom" id="solarsmartLoad">
  <Name>SolarSmart Load</Name>

  <ConfigUI>
    <!-- Intro -->
    <Field id="intro" type="label" fontColor="blue" fontSize="large">
      <Label>Configure a controllable load (priority, power, time windows, and how to switch it ON/OFF).</Label>
    </Field>

    <!-- Tier / Power -->
    <Field id="sep_tier" type="separator"/>
    <Field id="tier" type="menu" defaultValue="2">
      <Label>Priority Tier:</Label>
      <List>
        <Option value="1">Tier 1 (highest)</Option>
        <Option value="2">Tier 2</Option>
        <Option value="3">Tier 3</Option>
        <Option value="4">Tier 4</Option>
      </List>
    </Field>

    <Field id="ratedWatts" type="textfield" defaultValue="2000">
      <Label>Rated Power (Watts):</Label>
    </Field>

    <!-- Control mode -->
    <Field id="sep_ctrl" type="separator"/>
    <Field id="controlMode" type="menu" defaultValue="actionGroup">
      <Label>Control Method:</Label>
      <List>
        <Option value="actionGroup">Use Action Groups</Option>
        <Option value="device">Control an Indigo Device (On/Off)</Option>
      </List>
      <CallbackMethod>control_mode_changed</CallbackMethod>
    </Field>

    <!-- Action Group control -->
    <Field id="onActionGroupId" type="menu" defaultValue="-1" visibleBindingId="controlMode" visibleBindingValue="actionGroup">
      <Label>Action Group (ON):</Label>
      <List class="self" method="action_group_list" dynamicReload="true"/>
    </Field>
    <Field id="offActionGroupId" type="menu" defaultValue="-1" visibleBindingId="controlMode" visibleBindingValue="actionGroup">
      <Label>Action Group (OFF):</Label>
      <List class="self" method="action_group_list" dynamicReload="true"/>
    </Field>

    <!-- Device control -->
    <Field id="controlDeviceId" type="menu" defaultValue="-1" visibleBindingId="controlMode" visibleBindingValue="device">
      <Label>Target Device:</Label>
      <List class="self" method="enabled_device_list" dynamicReload="true"/>
      <CallbackMethod>control_device_changed</CallbackMethod>
    </Field>
    <Field id="onCommand" type="menu" defaultValue="turnOn" visibleBindingId="controlMode" visibleBindingValue="device">
      <Label>ON Command:</Label>
      <List>
        <Option value="turnOn">Turn On</Option>
        <Option value="turnOff">Turn Off (invert)</Option>
        <Option value="toggle">Toggle</Option>
      </List>
    </Field>
    <Field id="offCommand" type="menu" defaultValue="turnOff" visibleBindingId="controlMode" visibleBindingValue="device">
      <Label>OFF Command:</Label>
      <List>
        <Option value="turnOff">Turn Off</Option>
         <Option value="turnOn">Turn On (invert)</Option>
        <Option value="toggle">Toggle</Option>
      </List>
    </Field>
    <Field id="sep_test" type="separator"/>
    <Field id="testOn" type="button" fontSize="medium" fontColor="blue">
      <Label>Test ON</Label>
      <Title>Test ON</Title>
      <CallbackMethod>test_on_clicked</CallbackMethod>
    </Field>
    <Field id="testOff" type="button" fontSize="medium" fontColor="blue">
      <Label>Test OFF</Label>
      <Title>Test OFF</Title>
      <CallbackMethod>test_off_clicked</CallbackMethod>
    </Field>
    <!-- Time windows -->
    <Field id="sep_time" type="separator"/>
    <Field id="windowStart" type="textfield" defaultValue="08:00">
      <Label>Allowed Window Start (HH:MM):</Label>
    </Field>
    <Field id="windowEnd" type="textfield" defaultValue="20:00">
      <Label>Allowed Window End (HH:MM):</Label>
    </Field>

    <!-- Days of week -->
    <Field id="dowHeader" type="label" fontColor="black" fontSize="medium">
      <Label>Allowed Days of Week:</Label>
    </Field>
    <Field id="dowMon" type="checkbox" defaultValue="true"><Label>Monday</Label></Field>
    <Field id="dowTue" type="checkbox" defaultValue="true"><Label>Tuesday</Label></Field>
    <Field id="dowWed" type="checkbox" defaultValue="true"><Label>Wednesday</Label></Field>
    <Field id="dowThu" type="checkbox" defaultValue="true"><Label>Thursday</Label></Field>
    <Field id="dowFri" type="checkbox" defaultValue="true"><Label>Friday</Label></Field>
    <Field id="dowSat" type="checkbox" defaultValue="true"><Label>Saturday</Label></Field>
    <Field id="dowSun" type="checkbox" defaultValue="true"><Label>Sunday</Label></Field>
  <!-- Runtime constraints -->
    <Field id="sep_runtime" type="separator"/>
    <Field id="minRuntimeMins" type="textfield" defaultValue="30" hidden="True">
      <Label>Minimum Runtime (minutes):</Label>
    </Field>
    <Field id="maxRuntimeMins" type="textfield" defaultValue="120" hidden="True">
      <Label>Maximum Runtime per Window (minutes):</Label>
    </Field>

    <!-- Quota window -->
    <Field id="quotaHeader" type="label" fontColor="black" fontSize="medium">
      <Label>Quota Window (rolling):</Label>
    </Field>
    <Field id="quotaWindow" type="menu" defaultValue="24h">
      <Label>Quota Period:</Label>
      <List>
        <Option value="12h">12 hours</Option>
        <Option value="24h">24 hours</Option>
        <Option value="1d">1 day</Option>
        <Option value="2d">2 days</Option>
        <Option value="3d">3 days</Option>
      </List>
    </Field>
    <Field id="maxRuntimePerQuotaMins" type="textfield" defaultValue="180">
      <Label>Max Runtime per Quota Window (minutes):</Label>
    </Field>



    <!-- Scheduled catch-up settings -->



     <Field id="sep_catchup" type="separator"/>


<Field id="enableCatchup" type="checkbox" defaultValue="false">
    <Label>Enable Scheduled Catch-up</Label>
    <Description></Description>
</Field>
        <Field id="catch_hint" type="label" fontColor="blue" fontSize="small" alwaysUseInDialogHeightCalc="true">
      <Label>
Scheduled Catchup.
If runtime not completed in window time period, Force ON during this window.
The maximum time specified here is the total time run that is needed to catch up.
If this amount is already met in Runtime above, no CatchUp will occur.</Label>
    </Field>
<Field id="catchupWindowStart" type="textfield" defaultValue="00:00">
    <Label>Catch-up Window Start</Label>
    <Description>Start time (HH:MM) for off‑peak catch‑up.</Description>
</Field>

<Field id="catchupWindowEnd" type="textfield" defaultValue="06:00">
    <Label>Catch-up Window End</Label>
    <Description>End time (HH:MM) for off‑peak catch‑up.</Description>
</Field>

<Field id="catchupRuntimeMins" type="textfield" defaultValue="60">
    <Label>Catch-up Runtime (mins)</Label>
    <Description>Minimum minutes to run during the catch‑up window if the daily minimum runtime hasn’t been met.</Description>
</Field>



    <!-- Scheduler nuances -->
    <Field id="sep_sched" type="separator"/>
    <Field id="mutexGroup" type="textfield" defaultValue="">
      <Label>Mutual-Exclusion Group (optional):</Label>
    </Field>
    <Field id="cooldownMins" type="textfield" defaultValue="10">
      <Label>Cooldown After Stop (minutes):</Label>
    </Field>
    <Field id="startMarginPct" type="textfield" defaultValue="20">
      <Label>Start Margin (% above rated Watts):</Label>
    </Field>
    <Field id="keepMarginPct" type="textfield" defaultValue="5">
      <Label>Keep-On Margin (% above rated Watts):</Label>
    </Field>
    <Field id="surgeMultiplier" type="textfield" defaultValue="1.2">
      <Label>Start Surge Multiplier:</Label>
    </Field>

    <!-- Save hint -->
    <Field id="sep_hint" type="separator"/>
    <Field id="hint" type="label" fontColor="darkgray" fontSize="small" alwaysUseInDialogHeightCalc="true">
      <Label>Tip: leave Mutex Group blank unless this load must never run with certain others (e.g., "PoolGroup").</Label>
    </Field>

  </ConfigUI>

  <!-- Primary display -->
  <UiDisplayStateId>Status</UiDisplayStateId>

  <States>
    <State id="Status">
      <ValueType>String</ValueType>
      <TriggerLabel>Load status</TriggerLabel>
      <ControlPageLabel>Load status</ControlPageLabel>
    </State>

    <State id="IsRunning">
      <ValueType>Boolean</ValueType>
      <TriggerLabel>Is running changed</TriggerLabel>
      <ControlPageLabel>Running</ControlPageLabel>
    </State>

    <State id="Tier">
      <ValueType>Integer</ValueType>
      <TriggerLabel>Tier changed</TriggerLabel>
      <ControlPageLabel>Tier</ControlPageLabel>
    </State>

    <State id="PowerRated">
      <ValueType>Integer</ValueType>
      <TriggerLabel>Rated power changed</TriggerLabel>
      <ControlPageLabel>Rated W</ControlPageLabel>
    </State>

    <State id="StartedAt">
      <ValueType>String</ValueType>
      <TriggerLabel>Start time changed</TriggerLabel>
      <ControlPageLabel>Started</ControlPageLabel>
    </State>

    <State id="RuntimeWindowMins">
      <ValueType>Integer</ValueType>
      <TriggerLabel>Window runtime changed</TriggerLabel>
      <ControlPageLabel>Runtime (window, min)</ControlPageLabel>
    </State>

    <State id="RuntimeQuotaMins">
      <ValueType>Integer</ValueType>
      <TriggerLabel>Quota runtime changed</TriggerLabel>
      <ControlPageLabel>Runtime (quota, min)</ControlPageLabel>
    </State>

    <State id="RemainingQuotaMins">
      <ValueType>Integer</ValueType>
      <TriggerLabel>Remaining quota changed</TriggerLabel>
      <ControlPageLabel>Remaining quota (min)</ControlPageLabel>
    </State>

            <!-- >>> NEW: Percentage of quota runtime completed -->
        <State id="RuntimeQuotaPct">
          <ValueType>Integer</ValueType>
          <TriggerLabel>Quota runtime percent changed</TriggerLabel>
          <ControlPageLabel>Quota Runtime (%)</ControlPageLabel>
        </State>
        <!-- <<< NEW -->
<State id="catchupActive">
  <ValueType>Boolean</ValueType>
  <TriggerLabel>Catch-up active changed</TriggerLabel>
  <ControlPageLabel>Catch-up Active</ControlPageLabel>
</State>
<State id="catchupRunTodayMins">
  <ValueType>Integer</ValueType>
  <TriggerLabel>Catch-up run today changed</TriggerLabel>
  <ControlPageLabel>Catch-up Run Today (mins)</ControlPageLabel>
</State>
<State id="catchupDailyTargetMins">
  <ValueType>Integer</ValueType>
  <TriggerLabel>Catch-up daily target changed</TriggerLabel>
  <ControlPageLabel>Catch-up Daily Target (mins)</ControlPageLabel>
</State>
<State id="catchupRemainingTodayMins">
  <ValueType>Integer</ValueType>
  <TriggerLabel>Catch-up remaining today changed</TriggerLabel>
  <ControlPageLabel>Catch-up Remaining Today (mins)</ControlPageLabel>
</State>
<State id="catchupRunWindowAccumMins">
  <ValueType>Integer</ValueType>
  <TriggerLabel>Catch-up window accumulated changed</TriggerLabel>
  <ControlPageLabel>Catch-up Window Accum (mins)</ControlPageLabel>
</State>
<State id="catchupLastStart">
  <ValueType>String</ValueType>
  <TriggerLabel>Catch-up last start changed</TriggerLabel>
  <ControlPageLabel>Catch-up Last Start</ControlPageLabel>
</State>
<State id="catchupLastStop">
  <ValueType>String</ValueType>
  <TriggerLabel>Catch-up last stop changed</TriggerLabel>
  <ControlPageLabel>Catch-up Last Stop</ControlPageLabel>
</State>
    <State id="LastReason">
      <ValueType>String</ValueType>
      <TriggerLabel>Last decision reason changed</TriggerLabel>
      <ControlPageLabel>Reason</ControlPageLabel>
    </State>
      <State id="RuntimeQuotaMins">
    <ValueType>Integer</ValueType>
    <TriggerLabel>Quota Minutes Used</TriggerLabel>
    <ControlPageLabel>Quota Minutes Used</ControlPageLabel>
  </State>
  <State id="RemainingQuotaMins">
    <ValueType>Integer</ValueType>
    <TriggerLabel>Quota Minutes Remaining</TriggerLabel>
    <ControlPageLabel>Quota Minutes Remaining</ControlPageLabel>
  </State>
  <State id="RuntimeWindowMins">
    <ValueType>Integer</ValueType>
    <TriggerLabel>Window Runtime Minutes</TriggerLabel>
    <ControlPageLabel>Window Runtime Minutes</ControlPageLabel>
  </State>

  <!-- Timestamps we persist across restarts -->
  <State id="QuotaAnchorTs">
    <ValueType>String</ValueType>
    <TriggerLabel>Quota Anchor (epoch)</TriggerLabel>
    <ControlPageLabel>Quota Anchor (epoch)</ControlPageLabel>
  </State>
  <State id="LastStartTs">
    <ValueType>String</ValueType>
    <TriggerLabel>Last Start (epoch)</TriggerLabel>
    <ControlPageLabel>Last Start (epoch)</ControlPageLabel>
  </State>
  </States>
</Device>

  <Device type="custom" id="solarsmartTest">
    <Name>SolarSmart Test Source</Name>

    <ConfigUI>
      <Field id="warn" type="label" fontColor="orange" fontSize="medium" alwaysUseInDialogHeightCalc="true">
        <Label>
This Test device will OVERRIDE the SolarSmart Main readings (PV, Consumption, Battery)
for testing purposes only. Disable or delete this device when finished.
        </Label>
      </Field>

      <Field id="pvTestW" type="textfield" defaultValue="0">
        <Label>Test Solar Production (W):</Label>
        <Description>Integer Watts (e.g., 4200)</Description>
      </Field>

      <Field id="consTestW" type="textfield" defaultValue="">
        <Label>Test Site Consumption (W):</Label>
        <Description>Integer Watts (optional, leave blank to omit)</Description>
      </Field>

      <Field id="battTestW" type="textfield" defaultValue="">
        <Label>Test Battery Power (W):</Label>
        <Description>Positive = charging, Negative = discharging (optional)</Description>
      </Field>

      <Field id="useGridHeadroom" type="checkbox" tooltip="Enabling will use Grid information as Net everything.">
        <Label>Use Grid Data Only:</Label>
        <Description> Use Grid usage + / - as only factor in load decisions</Description>
    </Field>
      <Field id="gridTestW" type="textfield" defaultValue="">
        <Label>Grid Battery Power (W):</Label>
        <Description>Positive = importing power, Negative = exporting power</Description>
      </Field>

    </ConfigUI>

    <UiDisplayStateId>Status</UiDisplayStateId>
        <States>
      <State id="Status">
        <ValueType>String</ValueType>
         <TriggerLabel>Test Device Status</TriggerLabel>
    <ControlPageLabel>Test Device Status</ControlPageLabel>
      </State>
      <State id="SolarTestW">
        <ValueType>Integer</ValueType>
            <TriggerLabel>SolarTestW</TriggerLabel>
    <ControlPageLabel>SolarTestW</ControlPageLabel>
      </State>
                <State id="GridTestW">
        <ValueType>Integer</ValueType>
            <TriggerLabel>GridTestW</TriggerLabel>
    <ControlPageLabel>GridTestW</ControlPageLabel>
      </State>
      <State id="ConsumptionTestW">
        <ValueType>Integer</ValueType>
            <TriggerLabel>ConsumptionTestW</TriggerLabel>
    <ControlPageLabel>ConsumptionTestW</ControlPageLabel>
      </State>
      <State id="BatteryTestW">
        <ValueType>Integer</ValueType>
            <TriggerLabel>BatteryTestW</TriggerLabel>
    <ControlPageLabel>BatteryTestW</ControlPageLabel>
      </State>
      <State id="LastUpdate">
        <ValueType>String</ValueType>
            <TriggerLabel>Last update (epoch)</TriggerLabel>
    <ControlPageLabel>Last update (epoch)</ControlPageLabel>
      </State>
    </States>
  </Device>



</Devices>

